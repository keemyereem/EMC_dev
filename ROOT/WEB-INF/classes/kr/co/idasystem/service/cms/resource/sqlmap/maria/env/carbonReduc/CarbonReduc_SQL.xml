<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="carbonReduc">

    <select id="getCarbonReductDtl" resultType="egovMap">
		SELECT A.*
			  ,DATE_FORMAT(NOW(),'%Y.%m.%d %H:%i') AS DATE
			  ,FORMAT(TOTAL_CURRENT_PINE/A.GRAPH_GOAL*100,2) AS TOTAL_PERSENT
			  
			  ,FORMAT((SOLAR_CURRENT_PINE+DIGSTNTAK_CURRENT_PINE+DIGSTNGAS_CURRENT_PINE+STEAM_CURRENT_PINE+ETC_CURRENT_PINE)/A.GRAPH_GOAL*100,2) AS CARBON_PERCENTAGE
			  ,(SOLAR_CURRENT_PINE+DIGSTNTAK_CURRENT_PINE+DIGSTNGAS_CURRENT_PINE+STEAM_CURRENT_PINE+ETC_CURRENT_PINE) AS TOTAL_PINE
			  
			  ,FORMAT((SOLAR_PREV_PINE+DIGSTNTAK_PREV_PINE+DIGSTNGAS_PREV_PINE+STEAM_PREV_PINE+ETC_PREV_PINE)/A.GRAPH_GOAL*100,2) AS PREV_CARBON_PERCENTAGE
              ,(SOLAR_PREV_PINE+DIGSTNTAK_PREV_PINE+DIGSTNGAS_PREV_PINE+STEAM_PREV_PINE+ETC_PREV_PINE) AS PREV_TOTAL_PINE
		 FROM
			  (SELECT B.*,
					  ROUND((B.PINE_QUATER_SOLAR+B.PINE_QUATER_DIGSTNTAK+B.PINE_QUATER_DIGSTNGAS+B.PINE_QUATER_STEAM+B.PINE_QUATER_ETC)/91/24/60/60*((DAYOFYEAR(NOW())-1)*24*60*60+TIME_TO_SEC(CURRENT_TIME()))) AS TOTAL_CURRENT_PINE,
					  
					  ROUND((B.PINE_QUATER_SOLAR/365/24/60/60)*(((DAYOFYEAR(NOW())-1)*24*60*60)+TIME_TO_SEC(CURRENT_TIME()))) AS SOLAR_CURRENT_PINE,
					  ROUND((B.PINE_QUATER_DIGSTNTAK/365/24/60/60)*(((DAYOFYEAR(NOW())-1)*24*60*60)+TIME_TO_SEC(CURRENT_TIME()))) AS DIGSTNTAK_CURRENT_PINE,
					  ROUND((B.PINE_QUATER_DIGSTNGAS/365/24/60/60)*(((DAYOFYEAR(NOW())-1)*24*60*60)+TIME_TO_SEC(CURRENT_TIME()))) AS DIGSTNGAS_CURRENT_PINE,
					  ROUND((B.PINE_QUATER_STEAM/365/24/60/60)*(((DAYOFYEAR(NOW())-1)*24*60*60)+TIME_TO_SEC(CURRENT_TIME()))) AS STEAM_CURRENT_PINE,
					  ROUND((B.PINE_QUATER_ETC/365/24/60/60)*(((DAYOFYEAR(NOW())-1)*24*60*60)+TIME_TO_SEC(CURRENT_TIME()))) AS ETC_CURRENT_PINE,
                     
                      ROUND((B.PINE_LASTYEAR_SOLAR/365/24/60/60)*(((DAYOFYEAR(NOW())-1)*24*60*60)+TIME_TO_SEC(CURRENT_TIME()))) AS SOLAR_PREV_PINE,
					  ROUND((B.PINE_LASTYEAR_DIGSTNTAK/365/24/60/60)*(((DAYOFYEAR(NOW())-1)*24*60*60)+TIME_TO_SEC(CURRENT_TIME()))) AS DIGSTNTAK_PREV_PINE,
					  ROUND((B.PINE_LASTYEAR_DIGSTNGAS/365/24/60/60)*(((DAYOFYEAR(NOW())-1)*24*60*60)+TIME_TO_SEC(CURRENT_TIME()))) AS DIGSTNGAS_PREV_PINE,
					  ROUND((B.PINE_LASTYEAR_STEAM/365/24/60/60)*(((DAYOFYEAR(NOW())-1)*24*60*60)+TIME_TO_SEC(CURRENT_TIME()))) AS STEAM_PREV_PINE,
					  ROUND((B.PINE_LASTYEAR_ETC/365/24/60/60)*(((DAYOFYEAR(NOW())-1)*24*60*60)+TIME_TO_SEC(CURRENT_TIME()))) AS ETC_PREV_PINE                     
					 
				 FROM TB_CARBON_REDUCTION B
				WHERE DELETE_AT ='N'
				  AND NTT_NO    = #{nttNo}
				  AND LANG_CODE = #{langCode}
			  ) A
    </select>
 


</mapper>